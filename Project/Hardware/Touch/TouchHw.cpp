///////////////////////////////////////////////////////////////////////////////
//////////////////////////////// INCLUDES /////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////

#include "TouchHw.h"
#include "LoggerHw.h"
#include "Settings.h"

///////////////////////////////////////////////////////////////////////////////
/////////////////////////// CLASSES/STRUCTURES ////////////////////////////////
///////////////////////////////////////////////////////////////////////////////

Rectangle::Coordinates TouchHw::getCoordinates (void)
{
    uint8_t  xPos =                                       (getPos (createXPosCmd ()) - coefficient.Constant) * coefficient.Width;
    uint16_t yPos = Settings::GetInstance ().Lcd.Height - (getPos (createYPosCmd ()) - coefficient.Constant) * coefficient.Length;
    return { xPos, yPos };
}

uint16_t TouchHw::getPos (uint8_t v_cmd)
{
    SpiHw::Msg <ONE_BYTE> msg;
    msg.Cmd = v_cmd;

    memset                           (msg.Data, ZERO, ONE_BYTE);
    spiTouchHw.SendCommand           (SpiHw::EFlag::eDummy , SpiHw::EMode::eCmd , msg.Cmd);
    spiTouchHw.ReceiveData<ONE_BYTE> (SpiHw::EFlag::eRxData, SpiHw::EMode::eData, msg.Data);
    return msg.Data [FIRST_BYTE];
}

///////////////////////////////////////////////////////////////////////////////
/////////////////////////////// END OF FILE ///////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
